<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image Viewer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="viewer.css">


</head>

<body>

<header id="caption"></header>

<main>
    <div id="viewer-content">
        <div id="description"></div>
        <img id="image" src="" alt="">
    </div>
</main>

<footer>
    <button id="prev">◀ Previous</button>
    <button id="next">Next ▶</button>
    &nbsp;|&nbsp;
    <a href="javascript:window.close()">Close</a>
</footer>

<script>
const data = JSON.parse(
    decodeURIComponent(window.location.hash.substring(1))
);

function getScrollContainer() {
    if (main.scrollHeight > main.clientHeight) return main;

    const vc = document.getElementById("viewer-content");
    if (vc && vc.scrollHeight > vc.clientHeight) return vc;

    return document.scrollingElement;
}

let index = data.index;
const items = data.items;

const img = document.getElementById("image");
const cap = document.getElementById("caption");
const desc = document.getElementById("description");
const main = document.querySelector("main");   // NEW

function render() {
    img.classList.remove("expanded");

    img.src = items[index].src;
    img.alt = items[index].caption;

    cap.textContent  = items[index].caption;
    desc.textContent = items[index].description;
}

img.addEventListener("click", () => {
    const expanding = !img.classList.contains("expanded");
    img.classList.toggle("expanded");

    if (expanding) {
        const scroller = getScrollContainer();
        scroller.scrollTop = img.offsetTop;
    }
});


document.getElementById("next").onclick = () => {
    index = (index + 1) % items.length;
    render();
};

document.getElementById("prev").onclick = () => {
    index = (index - 1 + items.length) % items.length;
    render();
};

document.addEventListener("keydown", e => {
    if (e.key === "ArrowRight") document.getElementById("next").click();
    if (e.key === "ArrowLeft") document.getElementById("prev").click();
    if (e.key === "Escape") window.close();
});

render();
</script>


</body>
</html>
